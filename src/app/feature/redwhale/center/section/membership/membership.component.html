<div class="membership">
  <header>
    <div class="header--left">
      <span class="header--left-margin rw-typo-headline1">회원권</span>
      <span class="header--left-desc rw-typo-subtext1">회원권을 만들고, 예약 가능한 수업을 추가해보세요.</span>
    </div>
  </header>

  <main class="l-main">
    <section class="main__left thin-scroll-y-overlay2 " [ngClass]="{
              'main__left--flex' : (drawer$ | async).tabName == 'none',
              'main__left--flex-drawer' : (drawer$ | async).tabName != 'none'
            }">
      <!-- /< ----- category list -->
      <ng-container #category_peding *ngIf="(membershipIsloading$ | async) != 'done'; else category_done ">
        <ngx-skeleton-loader
          *ngFor="let _ of [1,2,3,4,5,6]"
          count=1 appearance="circle"
          [theme]="{width: '100%', height: '48px', 'border-radius': '5px', 'margin-top': '2px'}"
        ></ngx-skeleton-loader>
      </ng-container>
      <ng-template #category_done>
        <gm-center-membership-category
          *ngFor="let categ of (membershipCategEntities$ | async) | keyvalue : originOrder; last as isLast"
          [id]="categ.key"
          [categ]="categ.value"
          [centerId]="center.id"
        ></gm-center-membership-category>
      </ng-template>
      <!--  category list ---- >/ -->

      <!-- /< ----- add category button -->
      <ng-container>
        <div #AddCategInputOpen *ngIf="!isAddCategOn else AddCategInputOpen" (click)="onAddCategClick($event)"
          class="add-category-button"
          [class.add-category-button--top-margin]="(membershipCategEntities$ | async | keyvalue).length > 0">
          <img src="assets/icons/etc/add-category.svg">
          카테고리 추가
        </div>

        <ng-template #AddCategInputOpen>
          <form *ngIf="isAddCategOn" class="l-add-category-input"
            [class.l-add-category-input--top-margin]="(membershipCategEntities$ | async | keyvalue).length > 0">
            <input rw-autoFocus (rwClickOutside)="addCategory()" (keyup.enter)="addCategory()" [formControl]="addCategForm"
              class="rw-input add-category-input" type="text" placeholder="카테고리명을 입력해주세요.">
            <img src="assets/icons/etc/add-category.svg">
          </form>
        </ng-template>
      </ng-container>
      <!--  add category button ---- >/ -->

    </section>

    <section class="main__right thin-scroll-y-overlay2 "
      [ngClass] = "{
          'main__right--flex' : (drawer$ | async).tabName == 'none',
          'main__right--flex-drawer' : (drawer$ | async).tabName != 'none'
        }"
    >
      <p class="rw-typo-title1 p__selected-membership--margin">회원권 상세 정보</p>

      <ng-container #selected_membership_pending *ngIf="(membershipIsloading$ | async) != 'done' else selected_membership_done">
        <div class="selected-membership">
          <div class="selected-membership-top h-pos-relative">
            <ngx-skeleton-loader
              count = 1
              appearance="circle"
              [theme]="{ 'width': '100%' ,'height': '42px', 'border-radius': '5px'}"
              [ngStyle]="{'width':'100%'}"
            ></ngx-skeleton-loader>
          </div>
          <div class="divider"></div>
          <div class="selected-membership-middle">
            <ngx-skeleton-loader
              count = 1
              appearance="circle"
              [theme]="{width: '100%', height: '100%', 'border-radius': '5px'}"
              [ngStyle]="{'width': '100%'}"
            ></ngx-skeleton-loader>
          </div>
        </div>
      </ng-container>
      <ng-template #selected_membership_done>

        <div class="selected-membership">
          <div class="selected-membership-top">

            <div class="d-flex align-items-center">
              <div class="selected-membership-top__icon" [style.backgroundColor]="'var(--border-color)'">
                <img src="assets/icons/etc/ticket-white.svg">
              </div>
              <div class="rw-typo-title1 selected-membership-top__title ">
                <p
                  *ngIf="!selMembershipInputObj.name.isOn"
                  (click)="selectedMembership?.membershipData && onTextClick($event,'name')"
                  [style.cursor]="selectedMembership?.membershipData ? 'pointer' : 'auto'"
                >
                  {{selectedMembership?.membershipData ? selectedMembership.membershipData.name : '왼쪽 카테고리에서 회원권을 선택해주세요.'}}
                </p>
                <input
                  *ngIf="selMembershipInputObj.name.isOn"
                  class="rw-input"
                  rw-autoFocus
                  [formControl]="selMembershipInputObj.name.value"
                  (keyup.enter)=" updateMembershipItemInput('name')"
                  (rwClickOutside)=" updateMembershipItemInput('name')"
                >
              </div>
            </div>

            <div *ngIf="selectedMembership?.membershipData " class="d-flex ">
              <div class="selected-membership-top__delete-membership-button" (click)="setItemDelOpen()">
                <img src="assets/icons/etc/trash_grey.svg">
                <span class="rw-typo-subtext2">회원권 삭제</span>
              </div>
            </div>

          </div> <!--selected-membership-top end-->

          <div class="divider"></div>

          <div class="selected-membership-middle">

            <div
              *ngFor="let btItem of (btItems | keyvalue : kvOriginOrder)"
              class="selected-membership-middle__item"
            >
              <div
                class="l-item"
                (click)="selectedMembership?.membershipData
                        && !selMembershipInputObj[btItem.value.property].isOn
                        && onTextClick($event, btItem.value.property)"
                [style.cursor]="selectedMembership?.membershipData
                              && !selMembershipInputObj[btItem.value.property].isOn ? 'pointer' : 'auto'"
              >
                <p class="rw-typo-subtext2">{{btItem.value.title}}</p>
                <div
                  class="rw-typo-bodytext0 item-text"
                  *ngIf="!selMembershipInputObj[btItem.value.property].isOn"
                >

                  <span *ngIf="btItem.value.property == 'count'">
                    {{!selectedMembership?.membershipData ?
                      'ㅡ' :
                      selectedMembership?.membershipData?.unlimited == true ?
                      '무제한' :
                      selectedMembership.membershipData[btItem.value.property]+btItem.value.suffix
                    }}
                  </span>
                  <span *ngIf="btItem.value.property == 'days'">
                    {{!selectedMembership?.membershipData ?
                      'ㅡ' :
                      selectedMembership.membershipData[btItem.value.property]+btItem.value.suffix
                    }}
                  </span>
                  <span *ngIf="btItem.value.property == 'price'">
                    {{selectedMembership?.membershipData ? btItem.value.suffix+selectedMembership.membershipData[btItem.value.property] : 'ㅡ'}}
                  </span>

                  <img *ngIf="selectedMembership?.membershipData" class='edit-item-icon' src="assets/icons/etc/edit.svg" alt="">
                </div>
                <div
                  class="l-item-input"
                  *ngIf="selMembershipInputObj[btItem.value.property].isOn"
                >
                  <input
                    rw-autoFocus class="rw-input"
                    [class.input-price-width] = "btItem.value.property == 'price'"
                    [formControl]="selMembershipInputObj[btItem.value.property].value"
                    (keypress)="restrictToNumber($event)"
                    (keyup)="onSelectedItemInputKeyup($event, btItem.value.property)"
                    (keyup.enter)=" updateMembershipItemInput(btItem.value.property)"
                    (rwClickOutside)=" updateMembershipItemInput(btItem.value.property)"
                  >
                  <span
                    class="rw-typo-bodytext0"
                    [style.color] ="selMembershipInputObj[btItem.value.property]?.isInfinit ? 'var(--grey)' : 'var(--font-color)' "
                  >
                    {{btItem.value.suffix}}
                  </span>

                  <rw-checkbox
                    *ngIf="btItem.value.property == 'count'"
                    (click) = "toggleInfinitCount($event)"
                    [checked] = "selMembershipInputObj[btItem.value.property].isInfinit"
                    [text] = "'무제한'"
                  ></rw-checkbox>
                </div>
              </div>
            </div>

          </div> <!--selected-membership-middle end-->

          <div class="selected-membership-bottom"
            [style.display] = "selectedMembership?.membershipData == undefined ? 'none' : 'block' "
          >
            <p class="rw-typo-subtext2">메모</p>
            <textarea
              placeholder="메모를 입력해주세요."
              cols="30" rows="10"
              class="rw-typo-bodytext1 thin-scroll-y"
              (blur)="updateItemMemo(selMembershipMemo.value)"
              [formControl]="selMembershipMemo"
            >
            </textarea>
          </div> <!--selected-membership-bottom end-->
        </div>
      </ng-template>


      <!-- reservable membership -->
      <ng-container #selected_memLessonList_pending *ngIf = "(membershipIsloading$ | async) != 'done' else selected_memLessonList_done">
        <div class="selected-membership-lessonlist">
          <p class="rw-typo-subtext2 selected-membership-lessonlist--margin">
            예약 가능한 수업
          </p>
          <ngx-skeleton-loader
            count=5
            appearance="circle"
            [theme]="{'width':'calc(50% - 10px)', 'height' : '92px', 'border-radius' : '5px'}"
          ></ngx-skeleton-loader>
        </div>
      </ng-container>
      <ng-template #selected_memLessonList_done>
        <div class="selected-membership-lessonlist">

          <p class="rw-typo-subtext2 selected-membership-lessonlist--margin">
            예약 가능한 수업
          </p>

          <div
            *ngIf = "selectedMembership.membershipData"
            class="l-lesson-item thin-scroll-y"
          >
            <gl-lesson-card
              *ngFor="let memItem of selectedMembership.membershipData.class_items"
              [memLessonItem]="memItem"
              [categId]="selectedMembership.categId"
              [categName]="selectedMembership.categName"
              [centerId]="center.id"
              [isIn]="'reservableItemList'"
              (onReservableCardDelete)="removeReservationLesson(memItem.id, selectedMembership.membershipData.class_items)">
            </gl-lesson-card>

            <div class="add-lesson-button"
              (click)=" setReserveLessonModalOn(); $event.stopPropagation()"
            >
              <img src="assets/icons/etc/plus-darkgrey.svg">
              <p class="add-lesson-button__text">
                예약 가능한 수업 추가
              </p>
            </div>
          </div>

          <div class="l-guide-image"
            *ngIf="!selectedMembership.membershipData"
          >
            <div class="guide-image">
              <div class="guide-image__icon">
                <div class="icon" [style.backgroundColor]="'var(--border-color)'">
                  <img src="assets/icons/etc/workout_white.svg">
                </div>
                <div class="guide-image-icon__contents">
                  <p class="categ rw-typo-subtext2 ">레드웨일</p>
                  <div class="card-title-container rw-typo-title2">
                    <p class="card-title">레드웨일 수업</p>
                    <p class="card-desc1 rw-typo-subtext1">수업타입<span class="guide-image-bar">|</span>강사</p>
                  </div>
                </div>
              </div>
              <img src="assets/icons/etc/cursor_pointer.svg">
            </div>
            <div class="guide-text rw-typo-subtext2">
              <p>카테고리에서 회원권을 선택하신 후,</p>
              <p>예약 가능한 수업을 추가해보세요!</p>
            </div>
          </div>

          <div class="reserve-lesson-modal h-show-off"
            (rwClickOutside)="setReserveLessonModalOff()"
            [class.h-show-up]="isReservLessonListModalOn"
          >
            <div class="modal-header">
              <p class="rw-typo-subtext2">수업 목록</p>
              <img src="assets/icons/etc/close_grey.svg" (click)="setReserveLessonModalOff()">
            </div>

            <div
              class="card-container thin-scroll-y h-display-off"
              [class.h-display-on]="isReserveLessonExist"
            >

              <div *ngFor="let item of centerReservableLessonItemList" class="card">
                <gl-lesson-card
                  [categItem]="item"
                  [centerId]="center.id"
                  [categName]="item.category_name"
                  [isIn]="'addReservableItemList'"
                  (onAddReservableCard)="setReserveLessonModalOff()"
                ></gl-lesson-card>
              </div>


              <div class="lesson-guide-div">
                <p class="rw-typo-subtext2">추가해야 할 수업이 목록에 없으신가요?</p>
                <p class="rw-typo-subtext2">수업 페이지에서 수업을 바로 만들어보세요!</p>
                <div class="go-lesson-button" (click)="goToLessonSection()">
                  <p>수업 만들러 가기</p>
                  <img src="assets/icons/etc/short_right_arrow_grey.svg">
                </div>
              </div>
            </div>


            <div *ngIf=!isReserveLessonExist class="none-lesson">
              <img src="assets/icons/etc/empty_screen.svg">
              <p class="rw-typo-subtext2">더 이상 추가할 수 있는 수업이 없어요.</p>
              <p class="rw-typo-subtext2">수업 페이지에서 수업을 바로 만들어보세요!</p>
              <div class="go-lesson-button" (click)="goToLessonSection()">
                <p>수업 만들러 가기</p>
                <img src="assets/icons/etc/short_right_arrow_grey.svg">
              </div>
            </div>
          </div>

        </div>
      </ng-template>


    </section>
  </main>
</div>

<rw-modal
  [(visible)]="isItemDelOpen"
  [data]="delModalData"
  (cancel)="onDeleteItemCancel()"
  (confirm)="onDeleteItemConfirm()"
></rw-modal>
