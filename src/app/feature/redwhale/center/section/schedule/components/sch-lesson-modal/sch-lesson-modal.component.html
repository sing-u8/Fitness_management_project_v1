
<div class="rw-modal-background" #modalBackgroundElement></div>

<div
  class="rw-modal-wrapper justify-content-center align-items-center"
  (mouseup)="!isMouseModalDown && onCancel()"
  (mousedown) = 'resetMouseModalDown()'
  #modalWrapperElement
>
    <div
      class="rw-modal user-select-none"
      (mousedown) ='onMouseModalDown(); $event.stopPropagation()'
    >
      <div class="modal-header">
        <div class="header-title">
          <div class="rw-typo-bodytext0-bold d-flex align-items-center">
            <div class="color-icon" [style.backgroundColor] = "lessonData?.color ?  lessonData?.color : 'var(--border-color)'"></div>
            {{lessonData?.name}}
          </div>

        </div>
        <div class="close-button" (click)="onCancel()">
          <img src="assets/icons/etc/close.svg">
        </div>
      </div>

      <div class="modal-navigation">
        <div
          class="rw-typo-bodytext2-regular lesson-button"
          [class.selected]="screen_status == 'lesson'"
          (click)="onLessonClick()"
        >
          수업 정보
        </div>
        <div
          class="rw-typo-bodytext2-regular reservation-button"
          [class.selected]="screen_status == 'reservation'"
          (click)="onReservationClick()"
        >
          예약 현황
        </div>
      </div>



      <div
        *ngIf="screen_status == 'lesson'; else reservation"
        class="content-container thin-scroll-y-overlay2"
      >

        <div class="lesson-card">

          <div class="card-top">
            <div
              class="icon"
              [style.backgroundColor] = "lessonData?.color ?  lessonData?.color : 'var(--border-color)'"
            >
              <img src="assets/icons/etc/workout_white.svg">
            </div>
            <div class="card-desc">
              <p class="rw-typo-subtext0-regular card-category">{{lessonData?.lesson?.category_name}}</p>
              <p class="rw-typo-bodytext0-bold">{{lessonData?.name}}</p>
            </div>
          </div>
          <div class="card-bottom">
            <p class="card-desc2 rw-typo-subtext1">
              {{lessonData?.lesson?.minutes}}분
              <span class="bar">|</span>
              {{lessonData?.lesson?.type == 'onetoone' ? '1:1 수업' : '그룹 수업'}}
              <span class="bar">|</span>
              {{lessonData?.lesson?.trainers[0].gym_user_name}}
            </p>
          </div>

        </div>


        <div class="modal-content">
          <div class="small-title">일자</div>
          <div class="rw-typo-bodytext1 ">{{date}}</div>
        </div>
        <div class="modal-content">
          <div class="small-title">시간</div>
          <div class="rw-typo-bodytext1 ">{{time}}</div>
        </div>
        <div *ngIf="lessonData?.repetition_id" class="modal-content">
          <div class="small-title">일정 반복 기간</div>
          <div class="rw-typo-bodytext1 ">
            {{lessonData?.repetition_start_date | dateFormat:'YYYY.MM.DD'}} - {{lessonData?.repetition_end_date | dateFormat:'YYYY.MM.DD'}} {{repeatTimeDiff}} / {{repeatText}}
          </div>
        </div>
        <div class="modal-content">
          <div class="small-title">예약 인원</div>
          <div class="rw-typo-bodytext1 ">{{lessonData?.lesson?.reservation?.length}} / {{lessonData?.lesson.people}}</div>
        </div>
        <div *ngIf="lessonData?.memo" class="modal-content">
          <div class="small-title">상세 정보</div>
          <div class="rw-typo-bodytext1 ">{{lessonData?.memo | trimText}}</div>
        </div>
        <div class="modal-content">
          <div class="small-title">예약 가능 시간</div>
          <div class="rw-typo-bodytext1 ">{{reservationEnableTime}}</div>
        </div>
        <div class="modal-content">
          <div class="small-title">예약 취소 마감 시간</div>
          <div class="rw-typo-bodytext1 ">{{reservationCancelEndTime}}</div>
        </div>
        <div class="modal-content">
          <div class="small-title">예약 가능한 회원권</div>
          <div class="rw-typo-bodytext1 lesson-tag">
            <div
              *ngFor = "let membership of lessonData?.membership_item"
              class="tag-item"
            >
              {{membership.name}}
            </div>
          </div>
        </div>

      </div>

      <ng-template #reservation>
        <div
          *ngIf="screen_status == 'reservation';"
          class="content-container thin-scroll-y-overlay2"
        >
          <div
            *ngIf="lessonData?.lesson?.reservation?.length < 1; else reservation_exist"
            class="empty-guide"
          >
            <img src="assets/icons/etc/empty_screen.svg" >
            <p *ngIf="lessonData?.status == 'task_end'" class="rw-typo-subtext0-regular grey">예약을 신청한 회원이 없어요.</p>
            <p *ngIf="lessonData?.status != 'task_end'" class="rw-typo-subtext0-regular grey">아직 예약을 신청한 회원이 없어요.</p>
            <p *ngIf="lessonData?.status != 'task_end'" class="rw-typo-subtext0-regular grey">직접 회원을 예약하시겠어요?</p>
            <div *ngIf="lessonData?.status != 'task_end'" class="empty-button" (click)="onReserveMember()">
              <p>회원 예약하기</p>
              <img src="assets/icons/etc/short_right_arrow_grey.svg">
            </div>
          </div>

          <ng-template #reservation_exist>
            <div class="reservation-list thin-scroll-y-overlay2">
              <div class="reservation-header">
                <div class="rh-left">
                  <p class="rw-typo-bodytext0-bold">{{lessonData?.lesson?.people}}명 정원인 수업에</p>
                  <p class="rw-typo-bodytext0-bold"><span>{{lessonData?.lesson?.reservation?.length}}명</span>의 회원이 예약했어요.</p>
                </div>
                <div class="rh-right">
                  <div
                    *ngIf="( lessonData?.status == 'reservation_available' && lessonData?.lesson?.people > lessonData?.lesson?.reservation?.length )"
                    class="rw-typo-subtext0 reserve-member-button"
                    (click)="onReserveMember()"
                  >
                    <img src="assets/icons/etc/plus-red.svg">
                    회원 예약
                  </div>
                </div>
              </div>


              <ng-container *ngIf="lessonData">
                <div
                  class="reservation-item"
                  *ngFor="let reservation of lessonData?.lesson?.reservation"
                >
                  <div class="item-left">
                    <rw-avatar
                      [image]="reservation.user.picture"
                      [text]="reservation.user.gym_user_name ? reservation.user.gym_user_name : reservation.user.given_name"
                      [backgroundColor]="reservation.user.color"
                      size="30" fontSize="12"
                    ></rw-avatar>
                    <span class="rw-typo-bodytext2">
                      {{reservation.user.gym_user_name ? reservation.user.gym_user_name : reservation.user.given_name}} ({{reservation.user.membership_number}})
                    </span>
                  </div>
                  <div class="item-right">
                    <div
                      *ngIf="lessonData?.status != 'task_end' || lessonData?.cancel_reservation_not_allowed_yn != 1"
                      class="close-button" (click)="onCancelReservedMember(reservation)">
                      <img src="assets/icons/etc/close_grey.svg">
                    </div>
                  </div>
                </div>
              </ng-container>


            </div>
          </ng-template>



        </div>
      </ng-template>


      <div class="modal-buttons">
        <div
          class="rw-typo-bodytext0-bold holding-button"
          (click) = "onDelete()"
        >
          <img src="assets/icons/etc/trash.svg">
          {{'삭제'}}
        </div>
        <div class="divider"></div>
        <div
          class="rw-typo-bodytext0-bold modify-button"
          (click) = "onModify()"
        >
          <img src="assets/icons/etc/edit.svg"> 일정 수정
        </div>
      </div>


    </div>
</div>




